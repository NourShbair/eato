# Testing

> [!NOTE]
> Return back to the [README.md](README.md) file.

## Code Validation

### HTML

I have used the recommended [HTML W3C Validator](https://validator.w3.org) to validate all of my HTML files.

| Directory | File | Screenshot | Notes |
| --- | --- | --- | --- |
| templates | [404.html](https://github.com/NourShbair/eato/blob/main/templates/404.html) | ![screenshot](documentation/validation/validate-404.png) | - |
| templates | [500.html](https://github.com/NourShbair/eato/blob/main/templates/500.html) | ![screenshot](documentation/validation/validate-500.png) | - |
| templates | [index.html](https://github.com/NourShbair/eato/blob/main/templates/index.html) | ![screenshot](documentation/validation/validate-home.png) | - |
| templates | [add_recipe.html](https://github.com/NourShbair/eato/blob/main/templates/recipes/add_recipe.html) | ![screenshot](documentation/validation/validate-add.png) | - |
| templates | [delete_recipe.html](https://github.com/NourShbair/eato/blob/main/templates/recipes/delete_recipe.html) | ![screenshot](documentation/validation/validate-delete.png) | - |
| templates | [edit_recipe.html](https://github.com/NourShbair/eato/blob/main/templates/recipes/edit_recipe.html) | ![screenshot](documentation/validation/validate-edit.png) | - |
| templates | [recipe_details.html](https://github.com/NourShbair/eato/blob/main/templates/recipes/recipe_details.html) | ![screenshot](documentation/validation/validate-recipe-details.png) | - |
| templates | [recipes_list.html](https://github.com/NourShbair/eato/blob/main/templates/recipes/recipes_list.html) | ![screenshot](documentation/validation/validate-recipes-list.png) | - |
| templates | [search_results.html](https://github.com/NourShbair/eato/blob/main/templates/recipes/search_results.html) | ![screenshot](documentation/validation/validate-login.png) | - |
| templates | [login.html](https://github.com/NourShbair/eato/blob/main/templates/registration/login.html) | ![screenshot](documentation/validation/validate-404.png) | - |
| templates | [signup.html](https://github.com/NourShbair/eato/blob/main/templates/registration/signup.html) | ![screenshot](documentation/validation/validate-signup.png) | - |


### CSS

I have used the recommended [CSS Jigsaw Validator](https://jigsaw.w3.org/css-validator) to validate all of my CSS files.

| Directory | File | URL | Screenshot | Notes |
| --- | --- | --- | --- | --- |
| static | [style.css](https://github.com/NourShbair/eato/blob/main/static/css/style.css) | [Link](https://jigsaw.w3.org/css-validator/validator?uri=https://eato-15691513b61b.herokuapp.com) | ![screenshot](documentation/validation/css-static-style.png) | No errors found |

### Python

I have used the recommended [PEP8 CI Python Linter](https://pep8ci.herokuapp.com) to validate all of my Python files.

| Directory | File | URL | Screenshot | Notes |
| --- | --- | --- | --- | --- |
| eato | [settings.py](https://github.com/NourShbair/eato/blob/main/eato/settings.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato/settings.py) | ![screenshot](documentation/validation/py-eato-settings.png) | - |
| eato | [urls.py](https://github.com/NourShbair/eato/blob/main/eato/urls.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato/urls.py) | ![screenshot](documentation/validation/py-eato-urls.png) | - |
| eato_app | [admin.py](https://github.com/NourShbair/eato/blob/main/eato_app/admin.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato_app/admin.py) | ![screenshot](documentation/validation/py-eato-app-admin.png) | - |
| eato_app | [models.py](https://github.com/NourShbair/eato/blob/main/eato_app/models.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato_app/models.py) | ![screenshot](documentation/validation/py-eato-app-models.png) | - |
| eato_app | [tests.py](https://github.com/NourShbair/eato/blob/main/eato_app/tests.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato_app/tests.py) | ![screenshot](documentation/validation/py-eato-app-tests.png) | - |
|  | [manage.py](https://github.com/NourShbair/eato/blob/main/manage.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/manage.py) | ![screenshot](documentation/validation/py--manage.png) | - |
| eato_app | [views.py](https://github.com/NourShbair/eato/blob/main/eato_app/views/views.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato_app/views/views.py) | ![screenshot](documentation/validation/py-eato-app-views.png) | - |
| eato_app | [signup.py](https://github.com/NourShbair/eato/blob/main/eato_app/views/registration/signup.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato_app/views/registration/signup.py) | ![screenshot](documentation/validation/py-eato-app-signup.png) | - |
| eato_app | [add_recipe.py](https://github.com/NourShbair/eato/blob/main/eato_app/views/recipes/add_recipe.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato_app/views/recipes/add_recipe.py) | ![screenshot](documentation/validation/py-eato-app-add.png) | - |
| eato_app | [recipe_details.py](https://github.com/NourShbair/eato/blob/main/eato_app/views/recipes/recipe_details.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato_app/views/recipes/recipe_details.py) | ![screenshot](documentation/validation/py-eato-app-details.png) | - |
| eato_app | [recipes_list.py](https://github.com/NourShbair/eato/blob/main/eato_app/views/recipes/recipes_list.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato_app/views/recipes/recipes_list.py) | ![screenshot](documentation/validation/py-eato-app-list.png) | - |
| eato_app | [search.py](https://github.com/NourShbair/eato/blob/main/eato_app/views/recipes/search.py) | [PEP8 CI Link](https://pep8ci.herokuapp.com/https://raw.githubusercontent.com/NourShbair/eato/main/eato_app/views/recipes/search.py) | ![screenshot](documentation/validation/py-eato-app-search.png) | - |



## Responsiveness

I've tested my deployed project to check for responsiveness issues.

| Page | Mobile | Tablet | Desktop | Notes |
| --- | --- | --- | --- | --- |
| Register | ![screenshot](documentation/responsiveness/chromium_mobile__signup.png) | ![screenshot](documentation/responsiveness/chromium_tablet__signup.png) | ![screenshot](documentation/responsiveness/chromium_desktop__signup.png) | Works as expected |
| Login | ![screenshot](documentation/responsiveness/chromium_mobile__login.png) | ![screenshot](documentation/responsiveness/chromium_tablet__login.png) | ![screenshot](documentation/responsiveness/chromium_desktop__login.png) | Works as expected |
| Home | ![screenshot](documentation/responsiveness/chromium_mobile__random_1.png) | ![screenshot](documentation/responsiveness/chromium_tablet__random_1.png) | ![screenshot](documentation/responsiveness/chromium_desktop__random_1.png) | Works as expected |
| Add Recipe | ![screenshot](documentation/responsiveness/chromium_mobile__recipes_add.png) | ![screenshot](documentation/responsiveness/chromium_tablet__recipes_add.png) | ![screenshot](documentation/responsiveness/chromium_desktop__recipes_add.png) | Works as expected |
| Edit Recipe | ![screenshot](documentation/responsiveness/chromium_mobile__recipes_18_edit_.png) | ![screenshot](documentation/responsiveness/chromium_tablet__recipes_18_edit_.png) | ![screenshot](documentation/responsiveness/chromium_desktop__recipes_18_edit_.png) | Works as expected |
| Delete Recipe | ![screenshot](documentation/responsiveness/chromium_mobile__recipes_18_delete_.png) | ![screenshot](documentation/responsiveness/chromium_tablet__recipes_18_delete_.png) | ![screenshot](documentation/responsiveness/chromium_desktop__recipes_18_delete_.png) | Works as expected |
| Recipes List | ![screenshot](documentation/responsiveness/chromium_mobile__recipes.png) | ![screenshot](documentation/responsiveness/chromium_tablet__recipes.png) | ![screenshot](documentation/responsiveness/chromium_desktop__recipes.png) | Works as expected |
| Recipe Details | ![screenshot](documentation/responsiveness/chromium_mobile__signup.png) | ![screenshot](documentation/responsiveness/chromium_tablet__signup.png) | ![screenshot](documentation/responsiveness/chromium_desktop__signup.png) | Works as expected |
| 404 | ![screenshot](documentation/responsiveness/chromium_mobile__recipes_test.png) | ![screenshot](documentation/responsiveness/chromium_tablet__recipes_test.png) | ![screenshot](documentation/responsiveness/chromium_desktop__recipes_test.png) | Works as expected |


## Browser Compatibility

I've tested my deployed project on multiple browsers to check for compatibility issues.

| Page | Chrome | Firefox | Safari | Notes |
| --- | --- | --- | --- | --- |
| Register | ![screenshot](documentation/browsers/chromium_desktop__signup.png) | ![screenshot](documentation/browsers/firefox_desktop__signup.png) | ![screenshot](documentation/browsers/safari_desktop__signup.png) | Works as expected |
| Login | ![screenshot](documentation/browsers/chromium_desktop__login.png) | ![screenshot](documentation/browsers/firefox_desktop__login.png) | ![screenshot](documentation/browsers/safari_desktop__login.png) | Works as expected |
| Home | ![screenshot](documentation/browsers/chromium_desktop__random_1.png) | ![screenshot](documentation/browsers/firefox_desktop__random_1.png) | ![screenshot](documentation/browsers/safari_desktop__random_1.png) | Works as expected |
| Add Recipe | ![screenshot](documentation/browsers/chromium_desktop__recipes_add.png) | ![screenshot](documentation/browsers/firefox_desktop__recipes_add.png) | ![screenshot](documentation/browsers/safari_desktop__recipes_add_.png) | Works as expected |
| Edit Recipe | ![screenshot](documentation/browsers/chromium_desktop__recipes_18_edit_.png) | ![screenshot](documentation/browsers/firefox_desktop__recipes_18_edit_.png) | ![screenshot](documentation/browsers/safari_desktop__recipes_18_edit_.png) | Works as expected |
| Delete Recipe | ![screenshot](documentation/browsers/chromium_desktop__recipes_18_delete_.png) | ![screenshot](documentation/browsers/firefox_desktop__recipes_18_delete_.png) | ![screenshot](documentation/browsers/safari_desktop__recipes_18_delete_.png) | Works as expected |
| Recipes List | ![screenshot](documentation/browsers/chromium_desktop__recipes.png) | ![screenshot](documentation/browsers/firefox_desktop__recipes.png) | ![screenshot](documentation/browsers/safari_desktop__recipes_.png) | Works as expected |
| Recipe Details | ![screenshot](documentation/browsers/chromium_desktop__recipes_18.png) | ![screenshot](documentation/browsers/firefox_desktop__recipes_18.png) | ![screenshot](documentation/browsers/safari_desktop__recipes_18_.png) | Works as expected |
| 404 | ![screenshot](documentation/browsers/chromium_desktop__recipes_test.png) | ![screenshot](documentation/browsers/firefox_desktop__recipes_test.png) | ![screenshot](documentation/browsers/safari_desktop__test.png) | Works as expected |

## Lighthouse Audit

I've tested my deployed project using the Lighthouse Audit tool to check for any major issues. Some warnings are outside of my control, and mobile results tend to be lower than desktop.

| Page | Mobile | Desktop |
| --- | --- | --- |
| Register | ![screenshot](documentation/lighthouse/mobile-signup.png) | ![screenshot](documentation/lighthouse/desktop-signup.png) |
| Login | ![screenshot](documentation/lighthouse/mobile-login.png) | ![screenshot](documentation/lighthouse/desktop-login.png) |
| Home | ![screenshot](documentation/lighthouse/mobile-home.png) | ![screenshot](documentation/lighthouse/desktop-home.png) |
| Recipes List | ![screenshot](documentation/lighthouse/mobile-list.png) | ![screenshot](documentation/lighthouse/desktop-list.png) |
| Recipe Details | ![screenshot](documentation/lighthouse/mobile-details.png) | ![screenshot](documentation/lighthouse/desktop-details.png) |
| 404 | ![screenshot](documentation/lighthouse/mobile-404.png) | ![screenshot](documentation/lighthouse/desktop-404.png) |

## Defensive Programming

Defensive programming was manually tested with the below user acceptance testing:

| Page | Expectation | Test | Result |
| --- | --- | --- | --- |
| Register | Prevent submission with missing fields. | Attempted to register with blank username and password fields. | Error message displayed: "This field is required". |
| Register | Prevent registration with existing username. | Tried registering with a username that already exists. | Error shown: "A user with that username already exists". |
| Login | Prevent login with incorrect credentials. | Entered wrong password for a valid user. | Login failed with error: "Please enter a correct username and password". |
| Add Recipe | Prevent recipe submission without required fields. | Tried submitting recipe without title, instructions, or image. | Field-specific validation errors displayed. |
| Add Recipe | Prevent invalid image uploads. | Attempted to upload a .txt file as an image. | Error shown: "Upload a valid image. The file you uploaded was either not an image or a corrupted image". |
| Add Recipe | Prevent ingredient submission with missing data. | Tried to submit ingredient row with empty name or quantity. | Ingredient row rejected; user prompted to complete all fields. |
| User Authentication | Feature is expected to allow registered users to log in to the site. | Attempted to log in with valid and invalid credentials. | Login was successful with valid credentials; invalid credentials were rejected. |
| Recipe Details | Handle non-existent recipe ID. | Accessed /recipe/9999/ where ID doesn't exist. | Custom 404 page displayed. |
| Search | Prevent search crash on special characters. | Searched using !@#$%^&*(). | No crash; search handled safely. |
| Like Recipe | Prevent duplicate likes. | Liked the same recipe twice. | Only one like recorded per user. |
| Save Recipe | Prevent duplicate saves. | Tried saving the same recipe multiple times. | Recipe saved once; no duplicates created. |
| Edit Recipe | Block unauthorized users from editing others' recipes. | Logged in as user A and tried to access edit page for user B's recipe. | Access denied (403) or redirected to homepage. |
| Delete Recipe | Require confirmation or permissions. | Tried deleting recipe directly via URL. | Deletion blocked for unauthorized user or confirmed for owner. |
| Logout | Ensure session termination. | Logged out and attempted to access protected page. | Redirected to login page. |
| 404 Error Page | Feature is expected to display a 404 error page for non-existent pages. | Navigated to an invalid URL (e.g., `/error`). | A custom 404 error page was displayed as expected. |
| 500 Error Page | Feature is expected to display a 500 error page for crash-exist pages. | Navigated to an invalid URL (e.g., `/crash`). | A custom 500 error page was displayed as expected.|


## User Story Testing

| Target | Expectation | Outcome |
| --- | --- | --- |
| As a user | I would like to register for an account | so that I can create and manage my own recipes |
| As a registerd user | I would like to log in to my account | so that I can access my saved and created recipes |
| As a registerd user | I would like to add a new recipe with a title, image, ingredients, and instructions | so that I can preserve and share my cooking methods |
| As a registerd user | I would like to edit or delete my own recipes | so that I can update them over time or remove them when necessary |
| As a registerd user | I would like to assign meal types, cuisine, and allergy tags to recipes | so that others can easily discover and filter suitable dishes |
| As a registerd user | I would like to upload and preview a recipe image | so that my recipe posts are more visually appealing |
| As a registerd user | I would like to save (bookmark) recipes I like | so that I can return to them easily later |
| As a registerd user | I would like to like a recipe | so that I can show appreciation and see popular dishes |
| As a user | I would like to view all the recipes I’ve saved or liked | so that I can revisit my favorites quickly |
| As a user | I would like to search recipes by title or ingredient | so that I can quickly find something specific to cook |


## Automated Testing

I have conducted a series of automated tests on my application.

> [!NOTE]
> I fully acknowledge and understand that, in a real-world scenario, an extensive set of additional tests would be more comprehensive.

### JavaScript (Jest Testing)

I have used the [Jest](https://jestjs.io) JavaScript testing framework to test the application functionality. In order to work with Jest, I first had to initialize NPM.

- `npm init`
- Hit `<enter>` for all options, except for **test command:**, just type `jest`.

Add Jest to a list called **Dev Dependencies** in a dev environment:

- `npm install --save-dev jest`

**IMPORTANT**: Initial configurations

When creating test files, the name of the file needs to be `file-name.test.js` in order for Jest to properly work. Without the following, Jest won't properly run the tests:

- `npm install -D jest-environment-jsdom`

Due to a change in Jest's default configuration, you'll need to add the following code to the top of the `.test.js` file:

```js
/**
 * @jest-environment jsdom
 */

const { test, expect } = require("@jest/globals");
const { function1, function2, function3, etc. } = require("../script-name");

beforeAll(() => {
    let fs = require("fs");
    let fileContents = fs.readFileSync("index.html", "utf-8");
    document.open();
    document.write(fileContents);
    document.close();
});
```

Remember to adjust the `fs.readFileSync()` to the specific file you'd like you test. The example above is testing the `index.html` file.

Finally, at the bottom of the script file where your primary scripts are written, include the following at the very bottom of the file. Make sure to include the name of all of your functions that are being tested in the `.test.js` file.

```js
if (typeof module !== "undefined") module.exports = {
    function1, function2, function3, etc.
};
```

Now that these steps have been undertaken, further tests can be written, and be expected to fail initially. Write JS code that can get the tests to pass as part of the Red-Green refactor process. Once ready, to run the tests, use this command:

- `npm test`

**NOTE**: To obtain a coverage report, use the following command:

- `npm test --coverage`

Below are the results from the tests that I've written for this application:

| Test Suites | Tests | Screenshot |
| --- | --- | --- |
| 4 passed | 4 passed | ![screenshot](documentation/unit-test.png) |

### Python (Unit Testing)

I have used Django's built-in unit testing framework to test the application functionality. In order to run the tests, I ran the following command in the terminal each time:

- `python3 manage.py test`

To create the coverage report, I would then run the following commands:

- `pip3 install coverage`
- `pip3 freeze --local > requirements.txt`
- `coverage run manage.py test`
- `coverage report`

To see the HTML version of the reports, and find out whether some pieces of code were missing, I ran the following commands:

- `coverage html`
- `python3 -m http.server`

Below are the results from the full coverage report on my application that I've tested:

![screenshot](documentation/unit-test-coverage-report.png)

#### Unit Test Issues

| Issue | Description | Solution |
| --- | --- | --- |
| AttributeError: 'Recipe' object has no attribute 'ingredients' | Occurs when trying to access .ingredients directly on Recipe object, but relationship is managed via RecipeIngredient (through model). | Fixed by querying RecipeIngredient.objects.filter(recipe=...) instead. |
| TypeError: Ingredient() got an unexpected keyword argument | Happens when trying to create an Ingredient with quantity and unit, which actually belong to the RecipeIngredient model. | Fixed by creating Ingredient separately, then creating RecipeIngredient to attach quantity/unit. |
| cloudinary.exceptions.Error: Invalid image file | Raised when using a fake or improperly formatted image in tests with CloudinaryField. | Fixed by creating Ingredient separately, then creating Fixed by generating a valid in-memory JPEG using PIL and BytesIO. |

## Bugs

### Fixed Bugs

| Bug | Description | Fix |
| --- | --- | --- |
| Label nesting error | Used {{ field.label_tag }} inside another <label> tag, causing HTML validation errors. | Replaced with {{ field.label_tag(attrs={'class': 'form-label'}) }} or used field.label inside custom label. |
| Ingredient() got unexpected keyword | Attempted to assign quantity and unit directly to Ingredient, which are part of RecipeIngredient. | Separated Ingredient creation from RecipeIngredient creation. |
| Invalid image file in tests | Using dummy byte content with CloudinaryField triggered Cloudinary error. | Fixed by generating a valid in-memory JPEG using Pillow and BytesIO. |


### Unfixed Bugs



[![GitHub issues](https://img.shields.io/github/issues/NourShbair/eato)](https://www.github.com/NourShbair/eato/issues)

Any remaining open issues can be tracked [here](https://www.github.com/NourShbair/eato/issues).

![screenshot](documentation/bugs/issues-open.png)

### Known Issues

| Bug | Description | Status / Notes |
| --- | --- | --- |
| Duplicate ingredient names allowed | Users can enter the same ingredient name multiple times in one recipe. | No uniqueness validation at the form level; requires custom formset or JS validation. |
| Inconsistent image preview behavior on some browsers | The image preview sometimes fails to show on mobile Safari. | Not consistently reproducible; needs further browser-specific testing and fallback handling. |
| Empty search header when using filters | When using filters (e.g., meal type, cuisine) without a keyword, the page header shows: Results for: "" instead of All Recipes or something relevant. | Needs conditional logic in template or view to detect presence of search query and fallback to appropriate heading (e.g., "Filtered Recipes" or "All Recipes"). |

> [!IMPORTANT]
> There are no remaining bugs that I am aware of, though, even after thorough testing, I cannot rule out the possibility.

